<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - PharmaSys</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary-color: #4361ee;
            --sidebar-width: 280px;
            --success-color: #00d1ff;
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: #f4f7fe;
            color: #2b3674;
        }

        /* Sidebar Styling */
        .sidebar { width: var(--sidebar-width); height: 100vh; position: fixed; background: white; z-index: 1000; border-right: 1px solid #eef2f6; }
        .logo-wrapper { padding: 2.5rem 1.5rem; font-weight: 800; font-size: 1.5rem; letter-spacing: -1px; color: var(--primary-color); }
        .nav-link { color: #a3aed0; padding: 0.8rem 1.5rem; margin: 0.2rem 1rem; display: flex; align-items: center; border-radius: 12px; font-weight: 600; transition: 0.2s; text-decoration: none; }
        .nav-link.active { background: var(--primary-color); color: white !important; box-shadow: 0px 10px 20px rgba(67, 97, 238, 0.23); }

        /* Main Content */
        .main-content { margin-left: var(--sidebar-width); padding: 2.5rem; }

        /* Modern Stat Cards */
        .stat-card { border: none; border-radius: 24px; background: white; padding: 1.5rem; transition: 0.3s; box-shadow: 0px 20px 40px rgba(0, 0, 0, 0.02); }
        .stat-card:hover { transform: translateY(-5px); box-shadow: 0px 25px 50px rgba(0, 0, 0, 0.05); }
        .icon-box { width: 56px; height: 56px; border-radius: 16px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; }

        /* System Health Section */
        .health-card { background: #111c44; border-radius: 24px; color: white; padding: 2rem; position: relative; overflow: hidden; }
        .health-card::before { content: ""; position: absolute; top: 0; right: 0; width: 150px; height: 150px; background: radial-gradient(circle, rgba(67, 97, 238, 0.4) 0%, transparent 70%); }
        
        /* Mini Chart CSS */
        .health-chart { display: flex; align-items: flex-end; gap: 8px; height: 60px; margin-top: 15px; }
        .chart-bar { width: 8px; background: rgba(255, 255, 255, 0.2); border-radius: 4px; animation: barGrow 2s infinite ease-in-out; }
        @keyframes barGrow { 0%, 100% { height: 30%; } 50% { height: 80%; } }

        .pulse { width: 10px; height: 10px; background: #01ff84; border-radius: 50%; display: inline-block; margin-right: 8px; box-shadow: 0 0 10px #01ff84; animation: pulseAni 1.5s infinite; }
        @keyframes pulseAni { 0% { opacity: 1; } 50% { opacity: 0.3; } 100% { opacity: 1; } }
    </style>
</head>

<body>

    <div class="sidebar d-flex flex-column shadow-sm">
        <div class="logo-wrapper"><i class="bi bi-capsule-pill me-2"></i>Pharma<span style="color: #2b3674;">Sys</span></div>
        <nav class="nav flex-column flex-grow-1">
            <a class="nav-link active" href="dashboard.html"><i class="bi bi-grid-fill me-2"></i> Dashboard</a>
            <a class="nav-link" href="pos.html"><i class="bi bi-cart3 me-2"></i> POS</a>
            <a class="nav-link" href="medicine.html"><i class="bi bi-capsule me-2"></i> Medicines</a>
            <a class="nav-link" href="inventory.html"><i class="bi bi-archive me-2"></i> Inventory</a>
            <a class="nav-link" href="employee.html"><i class="bi bi-people me-2"></i> Employees</a>
            <a class="nav-link" href="prescription.html"><i class="bi bi-file-earmark-medical-fill me-2"></i> Prescriptions</a>
            <a class="nav-link" href="reports.html"><i class="bi bi-graph-up-arrow me-2"></i> Reports</a>
            <a class="nav-link" href="settings.html"><i class="bi bi-sliders me-2"></i> Settings</a>
        </nav>
        <div class="p-4 border-top">
            <button onclick="logout()" class="btn btn-light text-danger w-100 fw-bold border-0">Logout</button>
        </div>
    </div>

    <div class="main-content">
        <header class="d-flex justify-content-between align-items-center mb-5">
            <div>
                <h2 class="fw-800" style="font-weight: 800;">Command Dashboard</h2>
                <p class="text-muted mb-0">Today is Thursday, Jan 15, 2026</p>
            </div>
            <div class="d-flex gap-3">
                <div class="bg-white p-2 px-3 rounded-pill shadow-sm small fw-bold text-primary">
                    <i class="bi bi-clock-history me-2"></i>Last Backup: 2h ago
                </div>
            </div>
        </header>

        <div class="row g-4 mb-4">
            <div class="col-md-3">
                <div class="stat-card">
                    <div class="icon-box bg-primary-subtle text-primary mb-3"><i class="bi bi-wallet2"></i></div>
                    <p class="text-muted small fw-bold text-uppercase mb-1">Today's Revenue</p>
                    <h3 class="fw-800 mb-0" id="todaySales">Rs. 42,850</h3>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card">
                    <div class="icon-box bg-success-subtle text-success mb-3"><i class="bi bi-box-seam"></i></div>
                    <p class="text-muted small fw-bold text-uppercase mb-1">Total Stock</p>
                    <h3 class="fw-800 mb-0" id="totalMeds">1,240</h3>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card">
                    <div class="icon-box bg-warning-subtle text-warning mb-3"><i class="bi bi-hourglass-split"></i></div>
                    <p class="text-muted small fw-bold text-uppercase mb-1">Expiring Soon</p>
                    <h3 class="fw-800 mb-0" id="expiringSoon">14</h3>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card">
                    <div class="icon-box bg-danger-subtle text-danger mb-3"><i class="bi bi-graph-down"></i></div>
                    <p class="text-muted small fw-bold text-uppercase mb-1">Low Inventory</p>
                    <h3 class="fw-800 mb-0" id="lowStock">08</h3>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-12">
                <div class="health-card shadow-lg">
                    <div class="row align-items-center">
                        <div class="col-md-4 border-end border-secondary border-opacity-25">
                            <h5 class="fw-bold mb-3"><i class="bi bi-cpu-fill me-2 text-info"></i>System Core Health</h5>
                            <div class="d-flex align-items-center mb-2">
                                <span class="pulse"></span>
                                <span class="fw-bold" id="statusUpdate">Core Services: Operational</span>
                            </div>
                            <p class="text-secondary small">All API endpoints are responding within nominal 45ms latency.</p>
                        </div>
                        <div class="col-md-4 border-end border-secondary border-opacity-25 ps-md-5">
                            <div class="stat-label small fw-bold text-uppercase text-secondary mb-2">Real-time Server Load</div>
                            <div class="health-chart">
                                <div class="chart-bar" style="animation-delay: 0.1s"></div>
                                <div class="chart-bar" style="animation-delay: 0.3s"></div>
                                <div class="chart-bar" style="animation-delay: 0.2s"></div>
                                <div class="chart-bar" style="animation-delay: 0.5s"></div>
                                <div class="chart-bar" style="animation-delay: 0.4s"></div>
                                <div class="chart-bar" style="animation-delay: 0.1s"></div>
                                <div class="chart-bar" style="animation-delay: 0.3s"></div>
                            </div>
                        </div>
                        <div class="col-md-4 ps-md-5">
                            <div class="d-flex justify-content-between mb-2">
                                <span class="small fw-bold">Cloud Sync</span>
                                <span class="small fw-bold">98%</span>
                            </div>
                            <div class="progress bg-dark mb-3" style="height: 6px;">
                                <div class="progress-bar bg-info" style="width: 98%"></div>
                            </div>
                            <button class="btn btn-outline-info btn-sm w-100 fw-bold rounded-pill" onclick="loadDashboard()">
                                Run System Diagnostic
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = "http://127.0.0.1:8000";

        async function loadDashboard() {
            const statusEl = document.getElementById("statusUpdate");
            statusEl.innerHTML = "Performing Diagnostic...";
            
            try {
                const res = await fetch(`${API_BASE}/dashboard`);
                if (!res.ok) throw new Error();
                const data = await res.json();

                document.getElementById("todaySales").innerText = "Rs. " + (data.today_sales || "42,850");
                document.getElementById("totalMeds").innerText = data.total_medicines || "1,240";
                document.getElementById("expiringSoon").innerText = data.expiring_soon || "14";
                document.getElementById("lowStock").innerText = data.low_stock || "08";

                statusEl.innerHTML = "Core Services: Operational";
            } catch {
                // If offline, keep the dummy data but show status
                console.log("Using local sandbox data");
                statusEl.innerHTML = "Core Services: Offline (Sandbox Mode)";
            }
        }

        function logout() {
            localStorage.removeItem("user");
            window.location.href = "login.html";
        }

        window.onload = loadDashboard;
    </script>
</body>
</html>